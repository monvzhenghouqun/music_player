
# 接口文档 (V1.84)


##### Base URL: `http://localhost:5000`
##### 最后更新: `2025-01-05`
----------


## 1. 发现页 (Discovery) 接口

### 1.1 获取每日推荐歌曲

基于用户偏好，通过后端决策树算法实时生成的推荐歌曲列表。

-   **接口地址**: `/recommendations/daily`
    
-   **请求方法**: `GET`

- **Query 参数**: - `user_id`: string (用户ID)
    
-   **响应格式**: JSON

   ```
{
    "songs": [
         {
         id: "101",
         song_id: "101", //兼容字段 //测试
         title: "1",
         artist: ["man"],
         album: "man", //专辑
         lyricist: "", //作词
         composer: "", //作曲
         language: "", //语言
         genre: "", //流派
         record_company: "", //唱片公司
         duration: "3:43", //时长
         filepath: "./assets/music/daily/test1.mp3", // 音乐地址
         url: "./assets/cover/cover_song/test1.jpg", // 封面图地址
         lyrics: "歌词第一句\n歌词第二句", //歌词
         is_deleted:"",
         created_at:""
         }
         ...
    ]
}
   ```
注：返回的是完整的歌曲集合，有几个生成几首歌曲

----------

### 1.2 获取热门推荐歌单

返回系统中的热门歌单集合。
-   **接口地址**：`getPopularPlaylists`

-   **接口地址**: `/recommendations/popular`
    
-   **请求方法**: `GET`
    
-   **响应格式**:
    JSON
    ```
    {
      count: 4,
      playlists:[
             {
             playlist_id: 50,
             title: "大手子致敬",
             creater_id: 10,
             type: "a",
             url:"./assets/cover/cover_playlist/test1.jpg",
             collect_count: 10,
             play_count: 10,
             song_count: 1
          },
          ...
	}
    ```
### 1.3 搜索歌曲 (新增)

根据关键词搜索歌曲。

-   **接口地址**: `/search`
    
-   **请求方法**: `GET`
    
-   **Query 参数**:
    
    -   `q`: string (搜索关键词)
    - 例：http://localhost:5000/search?q=xxx
        
-   **响应格式**: JSON

```
{
    "songs": [
        // 歌曲对象列表，结构同 1.1
    ]
}
```
    
## 2. 用户页 (Users) 接口

### 2.1 获取我喜欢的音乐 (歌单信息)

获取用户“喜欢”状态的特殊歌单概览。

-   **对应接口**:`getMyLikedPlaylist`。

-   **接口地址**: `/my/my_songlists_1_like?user_id=`
    
-   **请求方法**: `GET`
    
 -  **参数** :  `user_id`
    
-   **成功响应**: 
```
	{
    "count": 1,
    "playlists": [
        { "playlist_id": 11, "title": "我喜欢的音乐", "song_count": 12 }
    ]
	}
```
----------
### 2.2 获取最近播放歌单

获取用户最近播放的历史记录。
对应接口：`getMyRecentPlaylist`。

-   **接口地址**: `/my/my_songlists_1_recent?user_id=`
    
-   **请求方法**: `GET`
    
-   **参数**: `user_id`
- **成功响应**: 同 2.1

----------
    
### 2.3 获取我创建的标准歌单

渲染用户自建的歌单列表。
对应接口：`getMyCreatedPlaylists`。

-   **接口地址**: `/my/my_songlists_1?user_id=`
    
-   **请求方法**: `GET`
    
-   **Query 参数**: `user_id`
    
-   **成功响应**: 同 1.2 中的 playlists 结构
    
    ----------

### 2.4 获取我收藏的歌单

渲染用户从站内收藏的其他用户歌单。
对应接口：`getMyCollectedPlaylists`。

-   **接口地址**: `/my/my_songlists_2?user_id=`
    
-   **请求方法**: `GET`
    
-   **参数**: `user_id`
    
-   **成功响应**: 同 1.2 中的 playlists 结构

## 3. 通用接口

### 3.1 获取歌单详情 (包括热门歌单和标准歌单)

用于点击某个歌单后，获取该歌单的详细信息及其包含的所有歌曲。

-   **接口地址**: `/songslists/${playlist_id}?user_id=${currentId}`
    
-   **请求方法**: `GET`
    
-   **参数**: `playlist_id` (歌单唯一标识) ，`user_id` （具体用户_是否喜欢歌曲）           

-   **响应格式**:    
    

JSON

```
{
    "playlist_id": 50,    //歌单标识
    "songs": [
        {
            "id": "歌曲id",
            "song_id": "歌曲id",
            "title": "",
            "artist": [""],
            "album": "",
            "duration": "",    // 时长 4:53
            "filepath": "./assets/music/popular/test1.mp3",   //歌曲地址
            "url": "./assets/cover/cover_song/test1.jpg",   //歌曲封面地址
            "lyrics": "歌词内容...",
            "lyricist": "",
            "composer": "",
            "language": "",
            "genre": "",
            "record_company": "",
            "is_deleted": "",
            "created_at": ""
            "is_loved": ""
        }
        ...
    ]
}
```
### 3.2 歌曲点赞/取消点赞 (新增)

切换单曲的“喜欢”状态。

-   **接口地址**: `/like/toggle`
    
-   **请求方法**: `POST`
    
-   **请求体**:
    

JSON

```
{
    "user_id": "u123",
    "song_id": "s001",
    "is_loved": true  // true=喜欢, false=取消喜欢
}
```

-   **响应格式**: 
- `{ "success": true, "message": "操作成功" }`

### 3.3 记录播放历史 (新增)

当歌曲播放超过一定时长（如5秒）后调用。

-   **接口地址**: `/my/history/add`
    
-   **请求方法**: `POST`
    
-   **请求体**: JSON
```
{
    "user_id": "u123",
    "song_id": "s001",
    "timestamp": 1715436000000
}
```
## 4. 排行榜 (Rank)

### 4.1 全局排行榜（左侧）

基于全站数据，实时给出排行榜单数据。

-   **接口地址**: `/rank/public`
    
-   **请求方法**: `GET`
    
-   **响应格式**:
    

JSON

```
{
    "songs": [
        {
            id: "101",
					  song_id: "101", //兼容字段 //测试
						title: "1",
						artist: ["man"],
						album: "man", //专辑
						lyricist: "", //作词
						composer: "", //作曲
						language: "", //语言
						genre: "", //流派
						record_company: "", //唱片公司
						duration: "3:43", //时长
						filepath: "./assets/music/daily/test1.mp3", // 音乐地址
						url: "./assets/cover/cover_song/test1.jpg", // 封面图地址
						lyrics: "歌词第一句\n歌词第二句", //歌词
						is_deleted:"",
						created_at:""
						is_loved: ""
        }
        ...
    ]
}
```
注：返回的是完整的歌曲集合，必定是十个，格式和首页每日推荐一样

### 4.2 个人排行榜（右侧）

基于个人数据，实时给出排行榜单数据。

-   **接口地址**: `/rank/users/?user_id=`
    
-   **请求方法**: `GET`
    
-   **响应格式**:
    

JSON

```
{		
    "songs": [
        {
            id: "101",
					  song_id: "101", //兼容字段 //测试
						title: "1",
						artist: ["man"],
						album: "man", //专辑
						lyricist: "", //作词
						composer: "", //作曲
						language: "", //语言
						genre: "", //流派
						record_company: "", //唱片公司
						duration: "3:43", //时长
						filepath: "./assets/music/daily/test1.mp3", // 音乐地址
						url: "./assets/cover/cover_song/test1.jpg", // 封面图地址
						lyrics: "歌词第一句\n歌词第二句", //歌词
						is_deleted:"",
						created_at:""
						is_loved: ""
        }
        ...
    ]
}
```
注：返回的是完整的歌曲集合，必定是十个，格式和首页每日推荐一样

## 5. 歌单交互接口

### 5.1 收藏/取消收藏歌单

用于用户在歌单详情页点击“收藏”按钮时同步到后端。

-   **接口地址**: `/playlists/collect`
    
-   **请求方法**: `POST`
    
-   **请求体 (JSON)**:
    
    JSON
    
    ```
    {
        "user_id": "123456",
        "playlist_id": "50",
        "action": "collect" // 或 "uncollect"
    }
    ```
    
-   **响应格式**:
    
    JSON
    
    ```
    { "success": true, "message": "操作成功" }
    ```
    

### 5.2 检查歌单收藏状态

用于进入歌单页时，判断“收藏”按钮应该显示红心还是空心。

-   **接口地址**: `/playlists/is_collected？user_id=&playlist_id=`
    
-   **请求方法**: `GET`
    
-   **参数**: `user_id` (用户ID), `playlist_id` (歌单ID)
    
-   **响应格式**:
    
    JSON
    
    ```
    { "is_collected": true }
    ```
    
### 5.3 批量/单独添加歌曲到歌单

用于将一首或多首歌曲快速添加到用户指定的自建歌单中。

-   **接口地址**：`/playlist/songs/batch_add`
    
-   **请求方法**：`POST`
    
-   **请求体**：
JSON
```
	{	
		user_id: ,
		playlist_id:    //所处歌单id
		song_ids: ["s101", "s102"]
  }

```
-   **响应格式**:

```
{
    "success": true,
    "message": "成功添加 2 首歌曲",
    "added_count": 2
}
```

### 5.4 批量从歌单删除歌曲（修改了）

用于将一首或多首歌曲从用户指定的自建歌单中删除。

-   **接口地址**：`/playlist/songs/batch_delate`
    
-   **请求方法**：`POST`
    
-   **请求体**：
JSON
```
	{	
		user_id: "u123",,
		playlist_id:  "p_001", 
		song_ids: ["s101", "s102"]
     }

```
-   **响应格式**:

```
    {
	    "success": true,
	    "message": "成功删除 2 首歌曲",
	    "deleted_count": 2
    }
```

### 5.5 创建歌单(修改)

用于创建歌单。

-   **接口地址**：`/my/create_playlist`
    
-   **请求方法**：`POST`
    
-   **请求体**：
JSON
```
	{
    "user_id": "u12345",
    "title": "深夜学习歌单",
    "url":"" 
    "type":"" 
    ...
	}

```
-   **响应格式**:

```
    { 
    "success": true, 
    "playlist": { 
				    "playlist_id": "1725436800", 
				    "title": "深夜学习歌单", 
				    "creater_id": "user_id"，
				    "song_count": 0, 
				    "url": "src/img/default_cover.jpg" 
				 } 
    }
```

### 5.6 删除创建的歌单

用于将自建歌单删除。

-   **接口地址**：`/my/delete_playlist`
    
-   **请求方法**：`DELETE`
    
-   **请求体**：
JSON
```
{ 
"user_id": "u123", 
"playlist_id": "p_1725436800" }

```
-   **响应格式**:

```
    {
	    "success": true,
	    "message": "歌单成功删除",
	    //"dalated_count": 2    （可以不要）
    }
```




## 7. 用户与权限接口

### 7.1 用户注册 (获取 UID)

-   **接口地址**: `/auth/register`
    
-   **请求方法**: `POST`
    
-   **请求体**:
 ``` 
 { 
  "uid": "用户自定义UID"
  "cookie": "凭证字符串"
 } 
 ```

-   **响应**: `{ "success": true,  }`
    

### 7.2 用户登录 (通过 凭证)

-   **接口地址**: `/auth/login`
    
-   **请求方法**: `POST`
    
-   **请求体**: `{ "cookie": "凭证字符串" }`
    
-   **响应**:
    
    JSON
    
    ```
    {
        "success": true,
        "user_id": "123",
    }
    ```
## 8. 用户行为统计接口

### 8.1 批量上报用户播放行为

用于统计用户听歌习惯、计算歌曲热度及播放完成率。为了节省流量，前端会进行数据积攒后批量发送。

-   **接口地址**：`/analytics/batch_report`
    
-   **请求方法**：`POST`(支持 sendBeacon)
    
-   **数据格式**：`application/json`
    
-   **请求示例**：JSON

```
{
  "user_id": "u8888",
  "logs": [
    {
      "song_id": "s001",
      "duration": 180,
      "played_time": 180,
      "end_type": "complete",
      "position": 180,
      "timestamp": 1715436000000
    },
    {
      "song_id": "s002",
      "duration": 200,
      "played_time": 15.3,
      "end_type": "skip",
      "position": 15.3,
      "timestamp": 1715436200000
    }
  ]
}
```

#### 3. 响应结果 (Response)

JSON

```
{
  "success": true,
  "message": "成功处理 2 条日志数据"
}
```
